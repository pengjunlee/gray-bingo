import{d as v,m as u,o as w,a as f,c as x,g,a7 as m}from"./index-bW01VDll.js";const h={space:7,canvasElement:y("charVideoCanvas"),width:800,height:450};function s(t=h){this.space=t.space||h.space,this.width=Math.ceil((h.width??window.innerWidth)/this.space),this.height=Math.ceil((h.height??window.innerHeight)/this.space),this.data={},this.cav={},this.ctx={},this.charVedio=t.canvasElement,this.charVedio.width=h.width??window.innerWidth,this.charVedio.height=h.height??window.innerHeight,this.textCtx=this.charVedio.getContext("2d"),this.init()}s.prototype.init=function(){this.initVideo(),this.initCanvas()};s.prototype.initVideo=function(t){this.video||(this.video=document.createElement("video")),t&&(this.video.src=t)};s.prototype.initCanvas=function(){this.cav=document.createElement("canvas"),this.ctx=this.cav.getContext("2d"),this.cav.width=this.width,this.cav.height=this.height};s.prototype.loadData=function(){return this.ctx.getImageData(0,0,this.width,this.height)};s.prototype.reDraw=function(t){for(var e=0,a=t.data.length;e<a;e+=4){var n=t.data[e],i=t.data[e+1],o=t.data[e+2];t.data[e]=t.data[e+1]=t.data[e+2]=255-(n+i+o)/3|0}this.data=t,this.ctx.putImageData(t,0,0,0,0,this.width,this.height)};s.prototype.drawText=function(){this.textCtx.clearRect(0,0,window.innerWidth,window.innerHeight);for(var t=this.data.data,e=' .,`"^:!?o+*wU$HB%@&#M'.split(""),a=0,n=t.length;a<n;a+=4){this.textCtx.fillStyle="#333";var i=(a/4|0)%this.width,o=Math.ceil(a/4/this.width),r=i*this.space,c=o*this.space,d=t[a]|0,p=Math.ceil(255/e.length),l=e[d/p|0];this.textCtx.font="12px courier",this.textCtx.fillText(l,r,c)}};s.prototype.interval=function(){var t=this;requestAnimationFrame(function(){if(!t.video.paused){t.ctx.drawImage(t.video,0,0,t.width,t.height);var e=t.loadData();t.reDraw(e),t.drawText()}t.interval()})};s.prototype.playFile=function(t){this.src=URL.createObjectURL(t),this.initVideo(this.src),this.interval(),this.video.play()};function y(t){return document.getElementById(t)}const _={style:{margin:"8px 0"}},C=v({__name:"IkunBox",setup(t){const e=()=>new Promise(n=>{const i=new XMLHttpRequest;i.open("GET","https://636f-codenav-8grj8px727565176-1256524210.tcb.qcloud.la/ikun.mp4",!0),i.responseType="blob",i.onload=()=>{i.status===200&&n(i.response)},i.send()}),a=u();return w(async()=>{const n=await e();n&&new s({canvasElement:a.value}).playFile(n)}),(n,i)=>(f(),x("div",_,[g("canvas",{ref_key:"canvasRef",ref:a,class:"charVideoCanvas"},null,512)]))}}),b=m(C,[["__scopeId","data-v-bda4d711"]]);export{b as default};
